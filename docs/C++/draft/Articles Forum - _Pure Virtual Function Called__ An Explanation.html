<!DOCTYPE html>
<!-- saved from url=(0062)https://www.artima.com/forums/flat.jsp?forum=226&thread=196881 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Articles Forum - "Pure Virtual Function Called": An Explanation</title>

<link rel="stylesheet" type="text/css" href="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/artima.css">
<link rel="shortcut icon" href="https://www.artima.com/favicon.ico">
<style type="text/css">
PRE {
    font-size : 9pt;
}
A {
    text-decoration : none;
}
A:hover {
    text-decoration : underline;
}
</style>
</head>
<body><table width="100%" bgcolor="#FFFFFF" style="margin-top: 5px">
<tbody><tr>
<td align="center">
<div id="topbanner" style="height: 90px"><noscript><a href='https://www.artima.com/zcr/adclick.php?n=a86d37e9' target='_top'><img src='https://www.artima.com/zcr/adview.php?what=zone:1&amp;n=a86d37e9' border='0' alt='' /></a></noscript></div>
</td>
</tr>
</tbody></table>
<table width="100%" cellspacing="0">
<tbody><tr>
<td align="left" valign="bottom">
<a href="https://www.artima.com/index.jsp"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/a7.gif" alt="The Artima Developer Community" border="0" width="550" height="43"></a>
</td>
</tr></tbody></table>
<table width="100%" bgcolor="#333333">
<tbody><tr>
<td align="center">
<div class="ml">
<a href="https://www.artima.com/articles" class="hl">Articles</a>&nbsp;|
<a href="https://www.artima.com/news/index.jsp" class="hl">News</a>&nbsp;|
<a href="https://www.artima.com/weblogs/index.jsp" class="hl">Weblogs</a>&nbsp;|
<a href="https://www.artima.com/shop/catalog" class="hl">Books</a>&nbsp;|
<a href="https://www.artima.com/forums/index.jsp" class="hl">Forums</a>
</div>
</td>
</tr>
</tbody></table>
<table width="100%" bgcolor="#CCEECC">
<tbody><tr>
<td align="center">
<div class="sc">
<a href="https://www.artima.com/forums/index.jsp">Artima Forums</a>&nbsp;| 
<a href="https://www.artima.com/forums/forum.jsp?forum=226">Articles</a>&nbsp;| 
<a href="https://www.artima.com/forums/forum.jsp?forum=106">Weblogs</a>&nbsp;| 
<a href="https://www.artima.com/forums/forum.jsp?forum=1">Java Answers</a>&nbsp;| 
<a href="https://www.artima.com/forums/index.jsp?type=interest">News</a>
</div>
</td>
</tr>
</tbody></table>
<table width="100%" bgcolor="#EEEEEE">
<tbody><tr>
<td align="center">
<div class="sc">
<span style="color: #555555">Sponsored Link</span> <span style="color: #888888">•</span> 
<script language="JavaScript" type="text/javascript" src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/adx.js.download"></script>
<script language="JavaScript" type="text/javascript">
<!--
   if (!document.phpAds_used) document.phpAds_used = ',';
   phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
   
   document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
   document.write ("https://www.artima.com/zcr/adjs.php?n=" + phpAds_random);
   document.write ("&amp;what=zone:9&amp;target=_top");   document.write ("&amp;exclude=" + document.phpAds_used);
   if (document.referrer)
      document.write ("&amp;referer=" + escape(document.referrer));
   document.write ("'><" + "/script>");
//-->
</script><noscript><a href='https://www.artima.com/zcr/adclick.php?n=a799ecf6' target='_top'><img src='https://www.artima.com/zcr/adview.php?what=zone:9&amp;n=a0587811' border='0' alt=''></a></noscript>
</div>
</td>
</tr>
</tbody></table>
<br>




<!-- start of jsp -->

<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tbody><tr>
    <td width="80%" valign="top">

<div class="tc">

<!-- forum title -->

<span class="sts">Articles Forum</span><br>

<!-- subject title -->

<span class="ts">"Pure Virtual Function Called": An Explanation</span><br>
</div>





    <p>

    <font size="-1" face="tahoma,arial,sans-serif">

<!-- replies line -->

    <b>12</b> replies on
    <b>1</b> page.

    



<!-- most recent reply -->

    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=196881&amp;start=0#256123" title="Go to the most recent message in this topic">Most recent reply</a>:
    Feb 26, 2007 9:00 AM

<!-- byline -->

    by
        
    <a href="https://www.artima.com/profile.jsp?user=32" title="Bill Venners&#39;s profile">Bill Venners</a>

    </font>

    </p></td>
    <td valign="top" width="20%" align="center">

<!-- loginbox start -->

    <table>
<tbody><tr>
<td>
<div class="loginbox">
Welcome <i>Guest</i><br>
&nbsp;&nbsp;<a href="https://www.artima.com/sign_in?d=forums%2Fflat.jsp%3Fforum%3D226%26thread%3D196881%26start%3D0">Sign In</a><br>
</div>
</td>
</tr>
</tbody></table>


<!-- loginbox end -->

    </td>
</tr>
</tbody></table>

<p>


<!-- if isWatchedThread start -->



<!-- if isWatchedThread end -->
<!-- topic navigation line start -->

</p><table cellpadding="0" cellspacing="2" border="0">
<tbody><tr>
	<td><a href="https://www.artima.com/forums/forum.jsp?forum=226"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/back_to.gif" width="12" height="12" alt="Go back to the topic listing" border="0"></a></td>
	<td nowrap=""><font size="-1">
        &nbsp;<a href="https://www.artima.com/forums/forum.jsp?forum=226" title="Go back to the topic listing">Back to Topic List</a>
        </font>
    </td>
    <td><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/blank.gif" width="10" height="1" border="0"></td>
	<td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Click to reply to this topic" border="0"></a></td>
	<td nowrap=""><font size="-1">
        &nbsp;<a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;reply=true" title="Click to reply to this topic">Reply to this Topic</a>
        </font>
    </td>
    <td><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/blank.gif" width="10" height="1" border="0"></td>
	<td><a href="https://www.artima.com/forums/search.jsp?forums=226"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/search.gif" width="17" height="17" alt="Click to search messages in this forum" border="0"></a></td>
	<td nowrap=""><font size="-1">
        &nbsp;<a href="https://www.artima.com/forums/search.jsp?forums=226" title="Click to search messages in this forum">Search Forum</a>
        </font>
    </td>

<!-- if isGuest begin -->

    

<!-- if isGuest end -->

    <td><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/blank.gif" width="10" height="1" border="0"></td>
	<td><a href="https://www.artima.com/forums/threaded.jsp?forum=226&amp;thread=196881"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/up_to.gif" width="12" height="12" alt="Click for a threaded view of the topic" border="0"></a></td>
	<td nowrap=""><font size="-1">
        &nbsp;<a href="https://www.artima.com/forums/threaded.jsp?forum=226&amp;thread=196881" title="Click for a threaded view of the topic">Threaded View</a>
        </font>
    </td>
    <td nowrap="">&nbsp;&nbsp;</td>
</tr>
</tbody></table>

<!-- topic navigation line end -->

<table cellpadding="0" cellspacing="2" border="0" width="100%" align="center">
<tbody><tr><td colspan="3"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/blank.gif" width="1" height="5" border="0"></td></tr>
<tr>
    <td width="1%" nowrap="">

<!-- if hasPrevious start -->


    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=210081"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/prev.gif" width="10" height="10" hspace="2" border="0"></a>
    <font size="-1">
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=210081">Previous Topic</a>
    </font>


<!-- if hasPrevious end -->

    </td>
    <td width="98%" align="center">

&nbsp;

    </td>
    <td width="1%" nowrap="">

<!-- if thread.hasNext start -->


    <font size="-1">
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=269720">Next Topic</a>
    </font>
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=269720"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/next.gif" width="10" height="10" hspace="2" border="0"></a>


<!-- if thread.hasNext end -->

    </td>
</tr>
</tbody></table>

<!-- flatview top bar -->


<table bgcolor="#CCEECC" cellpadding="3" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr><td>
    <font size="-1" face="tahoma,arial,sans-serif">
    Flat View: This topic has <b>12</b> replies on <b>1</b> page
    </font>
    </td>
</tr>
</tbody></table>


<!-- messages start -->




<!-- message start -->

<a name="256123"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=32" title="Bill Venners"><b>Bill Venners</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 2284
            <br>
            Nickname: bv
            <br>
            Registered: Jan, 2002
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>"Pure Virtual Function Called": An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Feb 26, 2007 9:00 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=256123&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=256123&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



<table align="right">
<tbody><tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<script language="JavaScript" type="text/javascript" src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/adx.js.download"></script>
<script language="JavaScript" type="text/javascript">
<!--
if (!document.phpAds_used) document.phpAds_used = ',';
phpAds_random = new String (Math.random()); phpAds_random = phpAds_random.substring(2,11);
document.write ("<" + "script language='JavaScript' type='text/javascript' src='");
document.write ("https://www.artima.com/zcr/adjs.php?n=" + phpAds_random);
document.write ("&amp;what=zone:2");
document.write ("&amp;exclude=" + document.phpAds_used);
if (document.referrer)
document.write ("&amp;referer=" + escape(document.referrer));
document.write ("'><" + "/script>");
//-->
</script><noscript><a href='https://www.artima.com/zcr/adclick.php?n=a74ab060' target='_blank'><img src='https://www.artima.com/zcr/adview.php?what=zone:2&amp;n=a74ab060' border='0' alt=''></a></noscript>

</center>
 </td>
</tr>
</tbody></table>

    "Pure virtual function called" is the dying message of the occasional crashed C++ program. What does it mean? You can find a couple of simple, well-documented explanations out there that apply to problems easy to diagnose during postmortem debugging. There is also another rather subtle bug that generates the same message. If you have a mysterious crash associated with that message, it might well mean your program went indirect on a dangling pointer. This article covers all these explanations:<br><br><a href="http://www.artima.com/cppsource/pure_virtual.html">http://www.artima.com/cppsource/pure_virtual.html</a>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>

<br>


<!-- message end -->



<!-- message start -->

<a name="257074"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=48491" title="Paul Chisholm"><b>Paul Chisholm</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: psrc
            <br>
            Registered: Mar, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Example program 1 for "Pure Virtual Function Called: An Explanation"</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 2, 2007 8:24 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257074&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257074&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    <pre><br>// Artima.com: The C++ Source: "Pure virtual function called",<br>// example 1, virtual function directly called in constructor.<br><br>#include &lt;cstdlib&gt;<br>#include &lt;iostream&gt;<br><br>class AbstractShape {<br>public:<br>	virtual double area() const = 0;<br>	double value() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~AbstractShape();<br>protected:<br>	AbstractShape(double valuePerSquareUnit);<br>private:<br>	double valuePerSquareUnit_;<br>};<br><br>class Rectangle : public AbstractShape {<br>public:<br>	Rectangle(double width, double height, double valuePerSquareUnit);<br>	virtual double area() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~Rectangle();<br>private:<br>	double width_;<br>	double height_;<br>};<br><br>AbstractShape::AbstractShape(double valuePerSquareUnit)<br>	: valuePerSquareUnit_(valuePerSquareUnit)<br>{<br>	// ERROR: Violation of Meyers 3rd Item 9!<br>	std::cout &lt;&lt; "creating shape, area = " &lt;&lt; area() &lt;&lt; std::endl;<br>}<br><br>AbstractShape::~AbstractShape()<br>{<br>}<br><br>#ifdef DEFINE_PURE_VIRTUAL_FUNCTION<br><br>// Some compilers optimize away the vtbl, and try to directly call the base<br>// class version of the virtual function. If the function is defined, the<br>// program links and runs; if not, it doesn't link.<br><br>double<br>AbstractShape::area() const<br>{<br>	return 0;<br>}<br><br>#endif /* DEFINE_PURE_VIRTUAL_FUNCTION */<br><br>double<br>AbstractShape::value() const<br>{<br>	return valuePerSquareUnit_ * area();<br>}<br><br>Rectangle::Rectangle(double width, double height, double valuePerSquareUnit)<br>	: AbstractShape(valuePerSquareUnit),<br>	width_(width),<br>	height_(height)<br>{<br>}<br><br>Rectangle::~Rectangle()<br>{<br>}<br><br>double<br>Rectangle::area() const<br>{<br>	return width_ * height_;<br>}<br><br>int<br>main(int argc, char** argv)<br>{<br>	if (argc != 4) {<br>		std::cerr &lt;&lt; "usage: " &lt;&lt; argv[0] &lt;&lt;<br>		  " width height valuePerSquareUnit" &lt;&lt; std::endl;<br>		return 1;  // Failure!<br>	}<br>	double width = std::atof(argv[1]);<br>	double height = std::atof(argv[2]);<br>	double valuePerSquareUnit = std::atof(argv[3]);<br><br>	Rectangle r(width, height, valuePerSquareUnit);<br>	std::cout &lt;&lt; "value = " &lt;&lt; r.value() &lt;&lt; std::endl;<br><br>	return 0;  // Success!<br>}<br></pre>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="257076"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=48491" title="Paul Chisholm"><b>Paul Chisholm</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: psrc
            <br>
            Registered: Mar, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Example program 2 for "Pure Virtual Function Called: An Explanation"</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 2, 2007 8:26 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257076&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257076&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    <pre><br>// Artima.com: The C++ Source: "Pure virtual function called",<br>// example 2, virtual function directly called in destructor.<br><br>#include &lt;cstdlib&gt;<br>#include &lt;iostream&gt;<br><br>class AbstractShape {<br>public:<br>	virtual double area() const = 0;<br>	double value() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~AbstractShape();<br>protected:<br>	AbstractShape(double valuePerSquareUnit);<br>private:<br>	double valuePerSquareUnit_;<br>};<br><br>class Rectangle : public AbstractShape {<br>public:<br>	Rectangle(double width, double height, double valuePerSquareUnit);<br>	virtual double area() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~Rectangle();<br>private:<br>	double width_;<br>	double height_;<br>};<br><br>AbstractShape::AbstractShape(double valuePerSquareUnit)<br>	: valuePerSquareUnit_(valuePerSquareUnit)<br>{<br>}<br><br>AbstractShape::~AbstractShape()<br>{<br>	// ERROR: Violation of Meyers 3rd Item 9!<br>	std::cout &lt;&lt; "destroying shape, area = " &lt;&lt; area() &lt;&lt; std::endl;<br>}<br><br>#ifdef DEFINE_PURE_VIRTUAL_FUNCTION<br><br>// Some compilers optimize away the vtbl, and try to directly call the base<br>// class version of the virtual function. If the function is defined, the<br>// program links and runs; if not, it doesn't link.<br><br>double<br>AbstractShape::area() const<br>{<br>	return 0;<br>}<br><br>#endif /* DEFINE_PURE_VIRTUAL_FUNCTION */<br><br>double<br>AbstractShape::value() const<br>{<br>	return valuePerSquareUnit_ * area();<br>}<br><br>Rectangle::Rectangle(double width, double height, double valuePerSquareUnit)<br>	: AbstractShape(valuePerSquareUnit),<br>	width_(width),<br>	height_(height)<br>{<br>}<br><br>Rectangle::~Rectangle()<br>{<br>}<br><br>double<br>Rectangle::area() const<br>{<br>	return width_ * height_;<br>}<br><br>int<br>main(int argc, char** argv)<br>{<br>	if (argc != 4) {<br>		std::cerr &lt;&lt; "usage: " &lt;&lt; argv[0] &lt;&lt;<br>		  " width height valuePerSquareUnit" &lt;&lt; std::endl;<br>		return 1;  // Failure!<br>	}<br>	double width = std::atof(argv[1]);<br>	double height = std::atof(argv[2]);<br>	double valuePerSquareUnit = std::atof(argv[3]);<br><br>	Rectangle r(width, height, valuePerSquareUnit);<br>	std::cout &lt;&lt; "value = " &lt;&lt; r.value() &lt;&lt; std::endl;<br><br>	return 0;  // Success!<br>}<br></pre>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="257078"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=48491" title="Paul Chisholm"><b>Paul Chisholm</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: psrc
            <br>
            Registered: Mar, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Example program 3 for "Pure Virtual Function Called: An Explanation"</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 2, 2007 8:27 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257078&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257078&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    <pre><br>// Artima.com: The C++ Source: "Pure virtual function called",<br>// example 3, virtual function indirectly called in constructor.<br><br>#include &lt;cstdlib&gt;<br>#include &lt;iostream&gt;<br><br>class AbstractShape {<br>public:<br>	virtual double area() const = 0;<br>	double value() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~AbstractShape();<br>protected:<br>	AbstractShape(double valuePerSquareUnit);<br>private:<br>	double valuePerSquareUnit_;<br>};<br><br>class Rectangle : public AbstractShape {<br>public:<br>	Rectangle(double width, double height, double valuePerSquareUnit);<br>	virtual double area() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~Rectangle();<br>private:<br>	double width_;<br>	double height_;<br>};<br><br>AbstractShape::AbstractShape(double valuePerSquareUnit)<br>	: valuePerSquareUnit_(valuePerSquareUnit)<br>{<br>	// ERROR: Indirect violation of Meyers 3rd Item 9!<br>	std::cout &lt;&lt; "creating shape, value = " &lt;&lt; value() &lt;&lt; std::endl;<br>}<br><br>AbstractShape::~AbstractShape()<br>{<br>}<br><br>#ifdef DEFINE_PURE_VIRTUAL_FUNCTION<br><br>// Some compilers optimize away the vtbl, and try to directly call the base<br>// class version of the virtual function. If the function is defined, the<br>// program links and runs; if not, it doesn't link.<br><br>double<br>AbstractShape::area() const<br>{<br>	return 0;<br>}<br><br>#endif /* DEFINE_PURE_VIRTUAL_FUNCTION */<br><br>double<br>AbstractShape::value() const<br>{<br>	return valuePerSquareUnit_ * area();<br>}<br><br>Rectangle::Rectangle(double width, double height, double valuePerSquareUnit)<br>	: AbstractShape(valuePerSquareUnit),<br>	width_(width),<br>	height_(height)<br>{<br>}<br><br>Rectangle::~Rectangle()<br>{<br>}<br><br>double<br>Rectangle::area() const<br>{<br>	return width_ * height_;<br>}<br><br>int<br>main(int argc, char** argv)<br>{<br>	if (argc != 4) {<br>		std::cerr &lt;&lt; "usage: " &lt;&lt; argv[0] &lt;&lt;<br>		  " width height valuePerSquareUnit" &lt;&lt; std::endl;<br>		return 1;  // Failure!<br>	}<br>	double width = std::atof(argv[1]);<br>	double height = std::atof(argv[2]);<br>	double valuePerSquareUnit = std::atof(argv[3]);<br><br>	Rectangle r(width, height, valuePerSquareUnit);<br>	std::cout &lt;&lt; "value = " &lt;&lt; r.value() &lt;&lt; std::endl;<br><br>	return 0;  // Success!<br>}<br></pre>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="257080"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=48491" title="Paul Chisholm"><b>Paul Chisholm</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: psrc
            <br>
            Registered: Mar, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Example program 4 for "Pure Virtual Function Called: An Explanation"</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 2, 2007 8:28 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257080&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257080&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    <pre><br>// Artima.com: The C++ Source: "Pure virtual function called",<br>// example 4, virtual function indirectly called in destructor.<br><br>#include &lt;cstdlib&gt;<br>#include &lt;iostream&gt;<br><br>class AbstractShape {<br>public:<br>	virtual double area() const = 0;<br>	double value() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~AbstractShape();<br>protected:<br>	AbstractShape(double valuePerSquareUnit);<br>private:<br>	double valuePerSquareUnit_;<br>};<br><br>class Rectangle : public AbstractShape {<br>public:<br>	Rectangle(double width, double height, double valuePerSquareUnit);<br>	virtual double area() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~Rectangle();<br>private:<br>	double width_;<br>	double height_;<br>};<br><br>AbstractShape::AbstractShape(double valuePerSquareUnit)<br>	: valuePerSquareUnit_(valuePerSquareUnit)<br>{<br>}<br><br>AbstractShape::~AbstractShape()<br>{<br>	// ERROR: Indirect violation of Meyers 3rd Item 9!<br>	std::cout &lt;&lt; "destroying shape, value = " &lt;&lt; value() &lt;&lt; std::endl;<br>}<br><br>#ifdef DEFINE_PURE_VIRTUAL_FUNCTION<br><br>// Some compilers optimize away the vtbl, and try to directly call the base<br>// class version of the virtual function. If the function is defined, the<br>// program links and runs; if not, it doesn't link.<br><br>double<br>AbstractShape::area() const<br>{<br>	return 0;<br>}<br><br>#endif /* DEFINE_PURE_VIRTUAL_FUNCTION */<br><br>double<br>AbstractShape::value() const<br>{<br>	return valuePerSquareUnit_ * area();<br>}<br><br>Rectangle::Rectangle(double width, double height, double valuePerSquareUnit)<br>	: AbstractShape(valuePerSquareUnit),<br>	width_(width),<br>	height_(height)<br>{<br>}<br><br>Rectangle::~Rectangle()<br>{<br>}<br><br>double<br>Rectangle::area() const<br>{<br>	return width_ * height_;<br>}<br><br>int<br>main(int argc, char** argv)<br>{<br>	if (argc != 4) {<br>		std::cerr &lt;&lt; "usage: " &lt;&lt; argv[0] &lt;&lt;<br>		  " width height valuePerSquareUnit" &lt;&lt; std::endl;<br>		return 1;  // Failure!<br>	}<br>	double width = std::atof(argv[1]);<br>	double height = std::atof(argv[2]);<br>	double valuePerSquareUnit = std::atof(argv[3]);<br><br>	Rectangle r(width, height, valuePerSquareUnit);<br>	std::cout &lt;&lt; "value = " &lt;&lt; r.value() &lt;&lt; std::endl;<br><br>	return 0;  // Success!<br>}<br></pre>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="257082"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=48491" title="Paul Chisholm"><b>Paul Chisholm</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: psrc
            <br>
            Registered: Mar, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Example program 5 for "Pure Virtual Function Called: An Explanation"</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 2, 2007 8:29 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257082&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257082&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    <pre><br>// Artima.com: The C++ Source: "Pure virtual function called",<br>// example 5, going indirect on a dangling pointer.<br><br>#include &lt;cstdlib&gt;<br>#include &lt;iostream&gt;<br><br>class AbstractShape {<br>public:<br>	virtual double area() const = 0;<br>	double value() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~AbstractShape();<br>protected:<br>	AbstractShape(double valuePerSquareUnit);<br>private:<br>	double valuePerSquareUnit_;<br>};<br><br>class Rectangle : public AbstractShape {<br>public:<br>	Rectangle(double width, double height, double valuePerSquareUnit);<br>	virtual double area() const;<br>	// Meyers 3rd Item 7:<br>	virtual ~Rectangle();<br>private:<br>	double width_;<br>	double height_;<br>};<br><br>AbstractShape::AbstractShape(double valuePerSquareUnit)<br>	: valuePerSquareUnit_(valuePerSquareUnit)<br>{<br>}<br><br>AbstractShape::~AbstractShape()<br>{<br> }<br><br>double<br>AbstractShape::value() const<br>{<br>	return valuePerSquareUnit_ * area();<br>}<br><br>Rectangle::Rectangle(double width, double height, double valuePerSquareUnit)<br>	: AbstractShape(valuePerSquareUnit),<br>	width_(width),<br>	height_(height)<br>{<br>}<br><br>Rectangle::~Rectangle()<br>{<br>}<br><br>double<br>Rectangle::area() const<br>{<br>	return width_ * height_;<br>}<br><br>int<br>main(int argc, char** argv)<br>{<br>	if (argc != 4) {<br>		std::cerr &lt;&lt; "usage: " &lt;&lt; argv[0] &lt;&lt;<br>		  " width height valuePerSquareUnit" &lt;&lt; std::endl;<br>		return 1;  // Failure!<br>	}<br>	double width = std::atof(argv[1]);<br>	double height = std::atof(argv[2]);<br>	double valuePerSquareUnit = std::atof(argv[3]);<br><br>	AbstractShape* p1 = new Rectangle(width, height, valuePerSquareUnit);<br>	std::cout &lt;&lt; "value = " &lt;&lt; p1-&gt;value() &lt;&lt; std::endl;<br>	AbstractShape* p2 = p1;  // Need another copy of the pointer.<br>	delete p1;<br>	std::cout &lt;&lt; "now value = " &lt;&lt; p2-&gt;value() &lt;&lt; std::endl;<br><br>	return 0;  // Success!<br>}<br></pre>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="257134"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=44871" title="Andrei Korostelev"><b>Andrei Korostelev</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: andreika
            <br>
            Registered: Aug, 2006
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 3, 2007 7:54 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257134&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=257134&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    WRT calling PVF from the constructor/destructor. The Standard says:<br><br>10.4/2 [class.abstract]<br>A pure virtual function need be defined only if explicitly called with the qualified-id syntax.<br><br>10.4/6 [class.abstract]<br>Member functions can be called from a constructor (or destructor) of an abstract class; the effect of making a virtual call (10.3) to a pure virtual function directly or indirectly for the object being created (or destroyed) from such a constructor (or destructor) is undefined.<br><br>12.7/3<br>Member functions, including virtual functions (10.3), can be called during construction or destruction (12.6.2). When a virtual function is called directly or indirectly from a constructor or from a destructor, and the object to which the call applies is the object under construction or destruction, the function called is the one defined in the constructor or destructor’s own class or in one of its bases, but not a function overriding it in a class derived from the constructor or destructor’s class, or overriding it in one of the other base classes of the most derived object.<br><br><br>Thus, we can say that a non-qualified PVF call from constructor (both explicit and implicit) is undefined behavior. Qualified PVF call from constructor leads to generating a code for the static call of this function. The fact that MSVC resolves the non-qualified call to a static call is just a special case of UB.



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="270009"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=49997" title="Bill T"><b>Bill T</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 3
            <br>
            Nickname: billt
            <br>
            Registered: Jun, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Jun 8, 2007 6:37 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=270009&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=270009&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    There's another scenario where this can happen that is common in multi-threaded, event-driven code:<br><br>Assume an abstract class that defines an interface (call it A), a base class (call it B) that derives from A, and that can be derived from, and a derived class (call it D) that represents what a user would write, and which derives from B.<br><br>Assume that B does not define the pure virtual method declared in A -- for instance, to force the derived class to implement it.<br><br>The pure virtual method is a "callback" method -- i.e., it is invoked in response to external events, and on a different thread.<br><br>If another thread invokes D's dtor while a callback is in progress, some "funny" things can happen:<br><br>    * D's dtor executes -- the object is still a "D" at this point.<br><br>    * At the end of D's dtor (but before ~D returns) B's dtor executes, since it is the next-most derived class. At this point the compiler replaces the vtable ptr in the object with B's vtable ptr, so the object is now a "B", not a "D" anymore. Remember that B chose not to define the pure virtual method, in order to force it to be defined in D.<br><br>    * Another thread invokes the callback function on the object in response to an external event. At this point you get a "pure virtual error", because B's vtable doesn't have an entry for the callback method -- B's dtor effectively changed the object from a "D" to a "B".<br><br>One possible solution to this problem is to use a lock to control access to the dtor and callback function. This doesn't work, however, unless the lock is acquired in the most-derived class ("D") -- by the time the object morphs into a "B" (at entry to B's dtor) it is already too late. <br><br>If the code in question is a library (our case), it may not be reasonable to expect users of the convenience class to have to remember to lock the object in their dtor.<br><br>For this reason, it seemed to us that the only reasonable solution was to not define the callback method as pure virtual, but as a "plain old" virtual method, with a default (no-op) implementation. When the callback function is invoked in response to the external event, at least there is a vtable entry for the compiler to call. This assumes, of course, that the callback method can be skipped -- not an unreasonable assumption for an object that is halfway deleted already anyway.



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="296051"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=33590" title="Rob Stewart"><b>Rob Stewart</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: robstewart
            <br>
            Registered: Aug, 2005
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Feb 19, 2008 9:24 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=296051&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=296051&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    &gt; There's another scenario where this can happen that is<br>&gt; common in multi-threaded, event-driven code:<br>[snip]<br>&gt; If another thread invokes D's dtor while a callback is in<br>&gt; progress, some "funny" things can happen:<br>[snip]<br>&gt; If the code in question is a library (our case), it may<br>&gt; not be reasonable to expect users of the convenience class<br>&gt; to have to remember to lock the object in their dtor.<br>&gt; <br>&gt; For this reason, it seemed to us that the only reasonable<br>&gt; solution was to not define the callback method as pure<br>&gt; virtual, but as a "plain old" virtual method, with a<br>&gt; default (no-op) implementation. When the callback function<br>&gt; is invoked in response to the external event, at least<br>&gt; there is a vtable entry for the compiler to call. This<br>&gt; assumes, of course, that the callback method can be<br>&gt; skipped -- not an unreasonable assumption for an object<br>&gt; that is halfway deleted already anyway.<br><br>The problem is that multiple threads are using a shared object without synchronizing access.  D's destructor has nothing to do with it.  Since the object exists in a queue to be used when an event occurs and in some other context where it can be deleted, those two contexts must be synchronized.  A simple means to that end is reference counting.



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="296055"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=33590" title="Rob Stewart"><b>Rob Stewart</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 5
            <br>
            Nickname: robstewart
            <br>
            Registered: Aug, 2005
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Feb 19, 2008 9:46 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=296055&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=296055&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    &gt; WRT calling PVF from the constructor/destructor. The<br>&gt; Standard says:<br>&gt; <br>&gt; 10.4/2 [class.abstract]<br>&gt; 10.4/6 [class.abstract]<br>&gt; 12.7/3<br>&gt; <br>&gt; Thus, we can say that a non-qualified PVF call from<br>&gt; constructor (both explicit and implicit) is undefined<br>&gt; behavior. Qualified PVF call from constructor leads to<br>&gt; generating a code for the static call of this function.<br>&gt; The fact that MSVC resolves the non-qualified call to a<br>&gt; static call is just a special case of UB.<br><br>Issue 230 seeks, quite reasonably, to resolve that, but it remains open to date: <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_active.html#230">http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_active.html#230</a>



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="299120"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=49997" title="Bill T"><b>Bill T</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 3
            <br>
            Nickname: billt
            <br>
            Registered: Jun, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 25, 2008 12:47 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=299120&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=299120&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    &gt;&gt;&gt;The problem is that multiple threads are using a shared object without synchronizing access.<br><br>You're right, but that's on purpose:  "One possible solution to this problem is to use a lock to control access to the dtor and callback function. This doesn't work, however, unless the lock is acquired in the most-derived class ("D") -- by the time the object morphs into a "B" (at entry to B's dtor) it is already too late.<br><br>If the code in question is a library (our case), it may not be reasonable to expect users of the convenience class to have to remember to lock the object in their dtor."



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="299122"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#ffffff">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=49997" title="Bill T"><b>Bill T</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 3
            <br>
            Nickname: billt
            <br>
            Registered: Jun, 2007
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Mar 25, 2008 12:57 PM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=299122&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=299122&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#ffffff">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    10.4/6 states:  "Member functions can be called from a ... destructor of an abstract class; the effect of making a virtual call (10.3) to a <b>pure</b> virtual function directly or indirectly for the object being ... destroyed from such a ... destructor is undefined." (emphasis mine).<br><br>However, in B's dtor, the virtual function is <b>not</b> pure -- that's the whole point of defining a no-op implementation.<br><br>12.7/3 states: "When a virtual function is called directly or indirectly from ... a destructor, and the object to which the call applies is the object under ... destruction, the function called is the one defined in the ... destructor’s own class or in one of its bases"<br> <br>BTW, the behavior of the described solution (do not define the callback method as pure virtual, but as a "plain old" virtual method, with a default (no-op) implementation) is observed to work correctly under MSVC and g++ (3.4.6).  <br><br>Based on my reading of the spec, this is in fact defined behavior.



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->



<!-- message start -->

<a name="426561"></a>

<table bgcolor="#cccccc" cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
	<td>
    <table bgcolor="#cccccc" cellpadding="4" cellspacing="1" border="0" width="100%">
    <tbody><tr bgcolor="#eeeeee">
        <td width="1%" rowspan="2" valign="top">
        <table cellpadding="0" cellspacing="0" border="0" width="140">
        <tbody><tr><td>
            <font size="-1" face="tahoma,arial,sans-serif" color="#000000">

			<a href="https://www.artima.com/profile.jsp?user=78885" title="Scott Colcord"><b>Scott Colcord</b></a>
            </font>

            <font size="-2" face="tahoma,arial,sans-serif" color="#000000">
            <br><br>
            Posts: 1
            <br>
            Nickname: sacolcor
            <br>
            Registered: Oct, 2011
            <br><br>


            </font>
            </td>
        </tr>
        </tbody></table>
        </td>
        <td width="97%">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        <b>Re: Pure Virtual Function Called: An Explanation</b>

        </font>
		</td>
        <td width="1%" nowrap="">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">
        Posted: Oct 5, 2011 6:56 AM
        </font>
        </td>

<!-- 'reply' link start -->

        <td width="1%" nowrap="" align="center">
            <table cellpadding="2" cellspacing="0" border="0">
            <tbody><tr>
                <td><a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=426561&amp;reply=true"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/reply.gif" width="17" height="17" alt="Reply to this message" hspace="3" border="0"></a></td>
                <td>
                <font size="-1" face="tahoma,arial,sans-serif">
                <a href="https://www.artima.com/forums/post.jsp?forum=226&amp;thread=196881&amp;message=426561&amp;reply=true" title="Reply to this message">Reply</a>
                </font>
                </td>
            </tr>
            </tbody></table>
        </td>

<!-- 'reply' link end -->

    </tr>
    <tr bgcolor="#eeeeee">
        <td width="99%" colspan="3" valign="top">
        <font size="-1" face="tahoma,arial,sans-serif" color="#000000">



    &lt;<a href="http://www.artima.com/cppsource/pure_virtual.html%3E:">http://www.artima.com/cppsource/pure_virtual.html&gt;:</a><br>&gt; Compilers are allowed to "zero out" (i.e., render unusable) &gt; pointers after destructing their pointed-to data.<br><br>I couldn't find this in the standard, can you provide a ref?



        </font>
		<p>
        </p></td>
    </tr>
    </tbody></table>
</td></tr>
</tbody></table>


<!-- message end -->


<!-- messages end -->
<!-- if numReplies > 0 start-->


<table bgcolor="#cccccc" cellpadding="1" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr>
    <td>
<table bgcolor="#EEEEEE" cellpadding="3" cellspacing="0" border="0" width="100%" align="center">
<tbody><tr><td>
    <font size="-1" face="tahoma,arial,sans-serif" color="#333333">
    Flat View: This topic has <b>12</b> replies
    on <b>1</b> page


    </font>
    </td>
</tr>
</tbody></table>
    </td>
</tr>
</tbody></table>



<!-- if numReplies > 0 end-->

<!-- previous/next topic bar start -->
<table cellpadding="0" cellspacing="2" border="0" width="100%" align="center">
<tbody><tr>
    <td width="1%" nowrap="" valign="top">

    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=210081" title="Cooperative Visitor: A Template Technique for Visitor Creation"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/prev.gif" width="10" height="10" hspace="2" alt="Topic: Cooperative Visitor: A Template Technique for Visitor Creation" border="0"></a>
    <font size="-1">
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=210081" title="Topic: Cooperative Visitor: A Template Technique for Visitor Creation">Previous Topic</a>
    </font>


    </td>
    <td width="98%" align="center">

&nbsp;

    </td>
    <td width="1%" nowrap="" valign="top">

    <font size="-1">
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=269720" title="Scala&#39;s Stackable Trait Pattern">Next Topic</a>
    </font>
    <a href="https://www.artima.com/forums/flat.jsp?forum=226&amp;thread=269720" title="Scala&#39;s Stackable Trait Pattern"><img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/next.gif" width="10" height="10" hspace="2" alt="Topic: Scala&#39;s Stackable Trait Pattern" border="0"></a>

    </td>
</tr>
</tbody></table>
<!-- previous/next topic bar end -->


<hr width="100%">
<table width="50%" align="center">
<tbody><tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div id="sponsoredlinks">
</div>
</div>
</td>
</tr>
</tbody></table>
<hr width="100%">
<center>
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script type="text/javascript" src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/f.txt">
</script>
<br>
<br>
<!-- SiteSearch Google -->
<form method="get" action="https://www.google.com/custom">
<table border="0" bgcolor="#ffffff">
<tbody><tr><td nowrap="nowrap" valign="top" align="left" height="32">
<a href="https://www.google.com/">
<img src="./Articles Forum - _Pure Virtual Function Called__ An Explanation_files/Logo_25wht.gif" border="0" alt="Google"></a>
</td>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="Artima.com">
<input type="text" name="q" size="31" maxlength="255" value="">
<input type="submit" name="sa" value="Search">
</td></tr>
<tr>
<td>&nbsp;</td>
<td nowrap="nowrap">
<font size="-1" color="#000000">
<input type="radio" name="sitesearch" value=""> Web
<input type="radio" name="sitesearch" value="Artima.com" checked="checked">Artima.com
</font>&nbsp;&nbsp;
<input type="hidden" name="client" value="pub-3911176865765226">
<input type="hidden" name="forid" value="1">
<input type="hidden" name="ie" value="ISO-8859-1">
<input type="hidden" name="oe" value="ISO-8859-1">
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:https://www.artima.com/images/artima150.gif;S:https://www.artima.com;FORID:1;">
<input type="hidden" name="hl" value="en">
</td></tr></tbody></table>
</form>
<!-- SiteSearch Google -->
</center>
<br>
<div class="sp">
<div style="text-align: center">
<a href="https://www.artima.com/copyright.html">Copyright</a> © 1996-2019 Artima, Inc. All Rights Reserved. - <a href="https://www.artima.com/privacy.html">Privacy Policy</a> - <a href="https://www.artima.com/termsofuse.html">Terms of Use</a>
</div>
</div>
<br>
<script language="JavaScript" type="text/javascript">
<!--
function initBannerVarForZone(zone) {
        initBannerVarForZoneWithScript(zone, 'adjs_modified');
}

function initBannerVarForZoneWithScript(zone, phpScript) {

        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random());
        phpAds_random = phpAds_random.substring(2,11);

        var nextScriptSrc = 'https://www.artima.com/zcr/' + phpScript + '.php?n=' +
                phpAds_random  +
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;

        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");

}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZone(1);
-->
</script>

<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('topbanner');
-->
</script>
<script language="JavaScript" type="text/javascript">
<!--
initBannerVarForZoneWithScript(4, 'textman');
-->
</script>

<script language="JavaScript" type="text/javascript">
<!--
replaceDiv('sponsoredlinks');
-->
</script>


</body></html>