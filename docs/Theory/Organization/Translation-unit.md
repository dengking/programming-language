# [Translation unit (programming)](https://en.wikipedia.org/wiki/Translation_unit_(programming))

In [C](https://en.wikipedia.org/wiki/C_(programming_language)) and [C++](https://en.wikipedia.org/wiki/C%2B%2B) programming language terminology, a **translation unit** is the ultimate input to a C or C++ [compiler](https://en.wikipedia.org/wiki/Compiler) from which an [object file](https://en.wikipedia.org/wiki/Object_file) is generated.[[1\]](https://en.wikipedia.org/wiki/Translation_unit_(programming)#cite_note--1) In casual usage it is sometimes referred to as a **compilation unit**. A translation unit roughly consists of a [source file](https://en.wikipedia.org/wiki/Source_file) after it has been processed by the [C preprocessor](https://en.wikipedia.org/wiki/C_preprocessor), meaning that [header files](https://en.wikipedia.org/wiki/Header_file) listed in [`#include` directives](https://en.wikipedia.org/wiki/Include_directive) are literally [included](https://en.wikipedia.org/wiki/Transclusion), sections of code within `#ifndef` may be included, and macros have been expanded.

## Context

A C program consists of *units* called *source files* (or *preprocessing files*), which, in addition to **source code**, includes **directives** for the [C preprocessor](https://en.wikipedia.org/wiki/C_preprocessor). A translation unit is the **output** of the **C preprocessor** – a source file after it has been [preprocessed](https://en.wikipedia.org/wiki/Preprocessor).

**Preprocessing** notably consists of expanding a source file to recursively replace all `#include` directives with the literal file declared in the directive (usually [header files](https://en.wikipedia.org/wiki/Header_file), but possibly other source files); the result of this step is a *preprocessing translation unit*. Further steps include [macro expansion](https://en.wikipedia.org/wiki/Macro_expansion) of `#define` directives, and [conditional compilation](https://en.wikipedia.org/wiki/Conditional_compilation) of `#ifdef` directives, among others; this translates the preprocessing translation unit into a *translation unit*. From a **translation unit**, the compiler generates an [object file](https://en.wikipedia.org/wiki/Object_file), which can be further processed and [linked](https://en.wikipedia.org/wiki/Linker_(computing)) (possibly with other object files) to form an [*executable program*](https://en.wikipedia.org/wiki/Executable).

Note that the preprocessor is in principle language agnostic, and is a [lexical preprocessor](https://en.wikipedia.org/wiki/Lexical_preprocessor), working at the [lexical analysis](https://en.wikipedia.org/wiki/Lexical_analysis) level – it does not do parsing, and thus is unable to do any processing specific to C syntax. The input to the compiler is the **translation unit**, and thus it does not see any **preprocessor directives**, which have all been processed before compiling starts. While a given translation unit is fundamentally based on a file, the actual source code fed into the compiler may appear substantially different than the source file that the programmer views, particularly due to the recursive inclusion of headers.

### Scope

**Translation units** define a [scope](https://en.wikipedia.org/wiki/Scope_(programming)), roughly [file scope](https://en.wikipedia.org/wiki/File_scope), and functioning similarly to [module scope](https://en.wikipedia.org/wiki/Module_scope); in C terminology this is referred to as [internal linkage](https://en.wikipedia.org/wiki/Internal_linkage), which is one of the two forms of [linkage](https://en.wikipedia.org/wiki/Linkage_(software)) in C. Names (functions and variables) declared outside of a function block may be visible either only within a given translation unit, in which case they are said to have internal linkage – they are not visible to the linker – or may be visible to other object files, in which case they are said to have [external linkage](https://en.wikipedia.org/wiki/External_linkage), and are visible to the linker.

***SUMMARY*** : 拥有 [file scope](https://en.wikipedia.org/wiki/File_scope)的name，programmer是可以对它的linkage进行控制，如果给它们加上`static`，则它们的linkage就是 [internal linkage](https://en.wikipedia.org/wiki/Internal_linkage)，则这些name是对linker不可见的；否则，默认情况下，它们的linkage是 [external linkage](https://en.wikipedia.org/wiki/External_linkage)，linker是可见的；参见[Linkage (software)](https://en.wikipedia.org/wiki/Linkage_(software)) 。

C does not have a notion of modules. However, separate object files (and hence also the translation units used to produce object files) function similarly to separate modules, and if a source file does not include other source files, internal linkage (translation unit scope) may be thought of as "file scope, including all header files".

### Code organization

The bulk of a project's code is typically held in files with a `.c` suffix (or `.cpp`, `.c++` or `.cc` for [C++](https://en.wikipedia.org/wiki/C%2B%2B), of which `.cpp` is used most conventionally). Files intended to be included typically have a `.h` suffix ( `.hpp` or `.hh` are also used for C++, but `.h`is the most common even for C++), and generally do not contain function or variable definitions to avoid name conflicts when headers are included in multiple source files, as is often the case. Header files can be, and often are, included in other header files. It is standard practice for all `.c` files in a project to include at least one `.h` file.

## See also

- [Single Compilation Unit](https://en.wikipedia.org/wiki/Single_Compilation_Unit)